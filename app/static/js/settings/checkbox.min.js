// i18n helper
(function(){
  function T(key, fallback){
    const path = String(key||'').split('.');
    let obj = (window.I18N_WEB || {});
    for (const p of path){ if (obj && typeof obj === 'object' && p in obj) obj = obj[p]; else return fallback; }
    return (typeof obj === 'string') ? obj : fallback;
  }

  const ON_FALLBACK  = "Ativado";
  const OFF_FALLBACK = "Desativado";

  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".form-check-input.js-switch-label").forEach(e => {
      const label = e.closest(".form-check")?.querySelector(".form-check-label");
      if (!label) return;
      const ON  = e.dataset.on  || T('common.enabled',  ON_FALLBACK);
      const OFF = e.dataset.off || T('common.disabled', OFF_FALLBACK);
      const apply = () => {
        label.textContent = e.checked ? ON : OFF;
        label.classList.toggle("text-success", e.checked);
        label.classList.toggle("text-muted", !e.checked);
      };
      // evita listeners duplicados
      e.removeEventListener("change", e._applySwitchLabel);
      e._applySwitchLabel = apply;
      apply();
      e.addEventListener("change", apply);
    });
  });

  // opcional pra re-aplicar após mudanças dinâmicas
  window.refreshSwitchLabels = () => document.dispatchEvent(new Event("DOMContentLoaded"));
})();
